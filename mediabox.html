<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor - OffsideTV</title>
    <link rel="stylesheet" href="styless.css">
    <link rel="icon" href="https://raw.githubusercontent.com/OffsideTV/logosweb/main/logopestaña2-.webp" type="image/webp">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PS1PQ89GCR"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-PS1PQ89GCR');
    </script>
</head>

<body>
    <header>
        <a href="index.html">
            <img src="https://cdn.jsdelivr.net/gh/OffsideTV/logosweb@main/logotvoriginal-.webp" alt="OffsideTV Logo" class="logo">
        </a>
        <button id="chanels" class="donate-button">Canales y agenda</button>
        <button id="reportButton" class="report-button">
            Reportar fallos
        </button>
        <button id="donateButton" class="donate-button">Dejar una donación</button>
    </header>
    <div class="container">
        <h2>Reproduciendo contenido</h2>
    
        <!-- Contenedor para el iframe -->
        <div id="video-container">
            <iframe id="video-iframe" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            
            <!-- Botón de pantalla completa -->
            <button id="fullscreen-btn" class="fullscreen-button" title="Pantalla completa">
                <i class="fas fa-expand"></i>
            </button>
            
            <!-- Elementos de error, ocultos por defecto -->
            <div id="error-message" style="display: none;">
                <p>Este archivo de video no se puede reproducir (Error 102630).</p>
            </div>
            <div id="fallback-link" style="display: none;">
                <p>Intenta verlo directamente aquí:</p>
                <a id="fallback-url" href="#" target="_blank">Ver video</a>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Mapa de streams
            const streams = {

    //Extensiones unicamente 
              "espn-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=RVNQTjJIRA",
                    "sandbox": true
                },

               

              "espn2-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=RVNQTjJfQXJn&lang=1",
                    "sandbox": true
                },


               
                
               "espn3-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=RVNQTjM&lang=1",
                    "sandbox": true
                },


            
                "espn4-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=RVNQTkhE&lang=1",
                    "sandbox": true
                },

                
                
                "espn5-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=RVNQTjQ=",
                    "sandbox": true
                },

               

                "espn6-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=Rm94U3BvcnRzM19VWQ%3D%3D&start=true",
                    "sandbox": true
                },


             
                "espn7-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=Rm94U3BvcnRzMl9VWQ==",
                    "sandbox": true
                },


               
                "espnpremiumext-a": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=Rm94X1Nwb3J0c19QcmVtaXVuX0hE",
                    "sandbox": true
                },

               


                "tntsportsext-a": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=VE5UX1Nwb3J0c19IRA",
                    "sandbox": true
                },

               


             
                "fox1ar-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=Rm94U3BvcnRz&lang=1",
                    "sandbox": true
                },
                

               "fox2ar-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=Rm94U3BvcnRzMkhE&lang=1",
                    "sandbox": true
                },

                

                "fox3ar-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=Rm94U3BvcnRzM0hE&lang=1",
                    "sandbox": true
                },
               
                


                

            
                "tyc-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=VHlDU3BvcnQ",
                    "sandbox": true
                },

              
                "telefe-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=VGVsZWZlSEQ=",
                    "sandbox": true
                },


                "tvpublica-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=Q2FuYWw3&lang=1",
                    "sandbox": true
                },


        

                "flow1-ext": {
                    "repro1": "https://offsidetv.netlify.app/transmi.html?get=RXZlbnRvczFIRA&lang=1",
                    "sandbox": true
                },

            //Canales de prueba
              
                "tntsportspremium": {
                    "repro1": "https://canalesonline.netlify.app/servidores/cvatt.html?get=VE5UX1Nwb3J0c19IRA",
                    "sandbox": true
                },
                
           
            };


            // Obtener parámetros de la URL
            const urlParams = new URLSearchParams(window.location.search);
            const channel = urlParams.get("ch");
            const getParam = urlParams.get("get");
            const iframe = document.getElementById("video-iframe");
            const errorMessage = document.getElementById("error-message");
            const fallbackLink = document.getElementById("fallback-link");
            const fallbackUrl = document.getElementById("fallback-url");

            // Verificación de elementos
            if (!iframe || !errorMessage || !fallbackLink || !fallbackUrl) {
                console.error("Uno o más elementos del DOM no se encontraron.");
                return;
            }

            // Manejar el canal o el parámetro get
            let streamUrl = "";
            if (channel && streams[channel]) {
                streamUrl = streams[channel]["repro1"];
                iframe.setAttribute("src", streamUrl);
                if (streams[channel].sandbox) {
                    iframe.setAttribute("sandbox", "allow-scripts allow-same-origin");
                } else {
                    iframe.removeAttribute("sandbox");
                }
            } else if (getParam) {
                let externalUrl = `https://nebunexa.co/cvatt.php?get=${getParam}`;
                if (getParam === "Rm94X1Nwb3J0c19QcmVtaXVuX0hE") {
                    externalUrl = `https://nebunexa.co/cvatt2.php?get=${getParam}&start=true`;
                } else if (["RVNQTjJIRA", "RVNQTjJfQXJn", "RVNQTjM", "RVNQTkhE", "Rm94U3BvcnRzMl9VWQ==", "RXZlbnRvczFIRA"].includes(getParam)) {
                    externalUrl = `https://nebunexa.co/temp.html?get=${getParam}${urlParams.get("lang") ? "&lang=" + urlParams.get("lang") : ""}`;
                }
                streamUrl = externalUrl;
                iframe.setAttribute("src", streamUrl);
                iframe.setAttribute("sandbox", "allow-scripts allow-same-origin"); // Aplicar sandbox para getParam
                fallbackUrl.href = externalUrl;
                fallbackUrl.textContent = externalUrl;
            } else {
                document.getElementById("video-container").innerHTML = '<p>Canal no disponible o desactivado.</p>';
                return;
            }

            // Mostrar mensaje de error y enlace de fallback si el iframe no carga
            iframe.onerror = function () {
                if (errorMessage && fallbackLink && fallbackUrl) {
                    errorMessage.style.display = "block";
                    fallbackLink.style.display = "block";
                } else {
                    console.error("Elementos de error o fallback no disponibles.");
                }
            };

            // Verificación adicional tras cargar el iframe
            iframe.onload = function () {
                if (iframe.contentDocument && iframe.contentDocument.body.textContent.includes("no se puede reproducir")) {
                    if (errorMessage && fallbackLink && fallbackUrl) {
                        errorMessage.style.display = "block";
                        fallbackLink.style.display = "block";
                    }
                }
            };

           
        });
    </script>

    <div class="dmca-button-container">
        <button id="dmcaButton">DMCA</button>
        <div id="dmcaText" class="dmca-text">
            <h2>Cumplimiento del DMCA</h2>
            <p><strong>Este sitio web cumple con el Digital Millennium Copyright Act (DMCA).</strong> No transmitimos ni alojamos de manera ilegal ningún juego, canal, evento u otro contenido protegido por derechos de autor.</p>
            
            <h2>Descargo de Responsabilidad</h2>
            <p><strong>Este sitio web opera de acuerdo con el Digital Millennium Copyright Act (DMCA).</strong> En virtud de esta ley, nos comprometemos a responder rápidamente a las reclamaciones de violación de derechos de autor y a tomar las medidas necesarias para eliminar el material infractor.</p>
            <p><strong>Los enlaces proporcionados en este sitio web apuntan a contenido alojado en servidores externos</strong> y no alojamos ni transmitimos de manera directa ningún material protegido por derechos de autor. No tenemos control sobre el contenido de estos servidores externos y no nos hacemos responsables por el uso indebido que se pueda hacer de dicho contenido.</p>
            
            <h2>Compromiso con los Derechos de Autor</h2>
            <p><strong>Entendemos la importancia de proteger los derechos de autor</strong> y estamos comprometidos a cumplir con todas las leyes aplicables. Si eres propietario de los derechos de autor de algún contenido y crees que se ha utilizado de manera inapropiada, te instamos a que nos contactes de inmediato para que podamos abordar el problema de manera efectiva.</p>
            <p><strong>Además del DMCA, este sitio web también se adhiere a otras leyes y regulaciones relacionadas con la propiedad intelectual y la protección de derechos de autor.</strong> Nos reservamos el derecho de modificar o eliminar cualquier enlace o contenido que infrinja estas leyes.</p>
            
            <h2>Contacto</h2>
            <p><strong>Correo electrónico:</strong> <a href="mailto:offsidetve@gmail.com">offsideteve@gmail.com</a></p>
        </div>
    </div>

    <!-- Botón de compartir con imagen redonda -->
    <div class="share-button-container">
        <button id="shareButton" class="share-button">
            <img src="https://cdn.jsdelivr.net/gh/OffsideTV/logosweb@main/compartir.png" alt="Compartir" class="share-icon">
        </button>
        <div id="shareMenu" class="share-menu">
            <!-- Opción para compartir enlace -->
            <a href="#" class="share-link" id="copyLink">
                <i class="fas fa-link"></i> Compartir canal
            </a>
            <!-- Opción para generar QR -->
            <a href="#" class="share-link" id="shareQR">
                <i class="fas fa-qrcode"></i> Generar QR
            </a>
            <!-- Nueva opción para la extensión -->
            <a href="https://chromewebstore.google.com/detail/opmeopcambhfimffbomjgemehjkbbmji?utm_source=item-share-cb" 
               class="share-link" 
               id="extensionLink" 
               target="_blank">
                <i class="fas fa-puzzle-piece"></i> Extensión M3U8
            </a>
        </div>
    </div>

    <script>
        // Agrega un evento al botón DMCA para mostrar/ocultar el texto y desplazar la página
        document.getElementById('dmcaButton').addEventListener('click', function() {
            const dmcaText = document.getElementById('dmcaText');
            
            // Alternar la visibilidad del texto
            if (dmcaText.style.display === "none" || dmcaText.style.display === "") {
                dmcaText.style.display = "block"; // Cambia a visible
                dmcaText.scrollIntoView({ behavior: 'smooth' }); // Desplaza hacia el div
            } else {
                dmcaText.style.display = "none"; // Oculta el texto
            }
        });

        document.getElementById('donateButton').addEventListener('click', function() {
            window.location.href = 'donaciones.html'; 
        });
       
        document.getElementById('chanels').addEventListener('click', function() {
            window.location.href = 'index.html'; // Redirige a la página de inicio
        });

        document.getElementById("reportButton").addEventListener("click", function() {
            window.location.href = 'fallos.html'; 
        });
    </script>

    <script>
        // Mostrar/ocultar el menú de compartir
        document.getElementById('shareButton').addEventListener('click', function() {
            var shareMenu = document.getElementById('shareMenu');
            shareMenu.classList.toggle('show');
        });

        // Cerrar el menú si se hace clic fuera de él
        window.addEventListener('click', function(event) {
            var shareMenu = document.getElementById('shareMenu');
            var shareButton = document.getElementById('shareButton');
            if (event.target !== shareButton && !shareButton.contains(event.target)) {
                shareMenu.classList.remove('show');
            }
        });

        // Copiar el enlace al portapapeles (compatible con móviles)
        document.getElementById('copyLink').addEventListener('click', function(event) {
            event.preventDefault();
            var url = window.location.href; // Obtiene la URL actual

            // Crea un elemento de texto temporal
            var tempInput = document.createElement('input');
            tempInput.value = url;
            document.body.appendChild(tempInput);

            // Selecciona y copia el texto
            tempInput.select();
            document.execCommand('copy');

            // Elimina el elemento temporal
            document.body.removeChild(tempInput);

            // Muestra un mensaje de confirmación con SweetAlert
            Swal.fire({
                icon: 'success',
                title: '¡Enlace copiado!',
                text: 'El enlace se copio correctamente. ¡Compartilo!',
                confirmButtonText: 'OK'
            });
        });

        document.getElementById('shareQR').addEventListener('click', function(event) {
            event.preventDefault();
            var url = window.location.href;

            // Crear un contenedor para el QR
            var qrContainer = document.createElement('div');
            qrContainer.id = 'qr-code';
            qrContainer.style.textAlign = 'center'; // Centrar el contenido

            // Generar el QR
            new QRCode(qrContainer, {
                text: url,
                width: 200, // Tamaño del QR
                height: 200,
                colorDark: "#000000", // Color del QR (negro)
                colorLight: "#ffffff", // Color de fondo (blanco)
                correctLevel: QRCode.CorrectLevel.H // Nivel de corrección de errores (alto)
            });

            // Mostrar el QR en un modal con SweetAlert
            Swal.fire({
                title: '¡Escanea el QR y compartí el canal!',
                html: qrContainer,
                showCloseButton: true,
                showConfirmButton: false,
                customClass: {
                    popup: 'qr-modal', // Clase CSS personalizada para el modal
                    title: 'qr-title', // Clase CSS para el título
                    htmlContainer: 'qr-html-container' // Clase CSS para el contenido del modal
                }
            });
        });

        // Funcionalidad de pantalla completa
        document.addEventListener("DOMContentLoaded", function() {
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const videoContainer = document.getElementById('video-container');
            const iframe = document.getElementById('video-iframe');

            if (fullscreenBtn && videoContainer) {
                fullscreenBtn.addEventListener('click', function() {
                    if (!document.fullscreenElement) {
                        // Entrar en pantalla completa
                        if (videoContainer.requestFullscreen) {
                            videoContainer.requestFullscreen();
                        } else if (videoContainer.webkitRequestFullscreen) {
                            videoContainer.webkitRequestFullscreen();
                        } else if (videoContainer.msRequestFullscreen) {
                            videoContainer.msRequestFullscreen();
                        }
                    } else {
                        // Salir de pantalla completa
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        } else if (document.webkitExitFullscreen) {
                            document.webkitExitFullscreen();
                        } else if (document.msExitFullscreen) {
                            document.msExitFullscreen();
                        }
                    }
                });

                // Cambiar el ícono cuando cambie el estado de pantalla completa
                document.addEventListener('fullscreenchange', updateFullscreenIcon);
                document.addEventListener('webkitfullscreenchange', updateFullscreenIcon);
                document.addEventListener('msfullscreenchange', updateFullscreenIcon);

                function updateFullscreenIcon() {
                    const icon = fullscreenBtn.querySelector('i');
                    if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                        icon.className = 'fas fa-compress';
                        fullscreenBtn.title = 'Salir de pantalla completa';
                        // Agregar clase al body para ocultar elementos
                        document.body.classList.add('fullscreen-active');
                    } else {
                        icon.className = 'fas fa-expand';
                        fullscreenBtn.title = 'Pantalla completa';
                        // Remover clase del body
                        document.body.classList.remove('fullscreen-active');
                    }
                }

                // Mostrar el botón solo cuando hay contenido reproduciéndose
                function checkIfVideoIsPlaying() {
                    const iframeSrc = iframe.src;
                    if (iframeSrc && iframeSrc.trim() !== '') {
                        fullscreenBtn.style.display = 'block';
                    } else {
                        fullscreenBtn.style.display = 'none';
                    }
                }

                // Variables para controlar la visibilidad del botón en pantalla completa
                let fullscreenButtonTimeout;
                let isFullscreen = false;

                // Función para mostrar temporalmente el botón en pantalla completa
                function showFullscreenButtonTemporarily() {
                    if (isFullscreen) {
                        fullscreenBtn.classList.add('show-temporarily');
                        
                        // Ocultar después de 3 segundos
                        clearTimeout(fullscreenButtonTimeout);
                        fullscreenButtonTimeout = setTimeout(() => {
                            if (isFullscreen) {
                                fullscreenBtn.classList.remove('show-temporarily');
                            }
                        }, 3000);
                    }
                }

                // Detectar movimiento del mouse en pantalla completa
                document.addEventListener('mousemove', function() {
                    if (isFullscreen) {
                        showFullscreenButtonTemporarily();
                    }
                });

                // Detectar eventos del iframe (pausa, play, etc.)
                iframe.addEventListener('load', function() {
                    try {
                        // Intentar acceder al contenido del iframe para detectar eventos
                        const iframeContent = iframe.contentWindow;
                        if (iframeContent) {
                            // Escuchar eventos de teclado que podrían indicar pausa/play
                            iframeContent.addEventListener('keydown', function(e) {
                                if (isFullscreen && (e.code === 'Space' || e.code === 'KeyP')) {
                                    showFullscreenButtonTemporarily();
                                }
                            });
                        }
                    } catch (e) {
                        // Error de CORS - no podemos acceder al contenido del iframe
                        console.log('No se puede acceder al contenido del iframe debido a CORS');
                    }
                });

                // Detectar clics en el iframe (podrían indicar pausa/play)
                iframe.addEventListener('click', function() {
                    if (isFullscreen) {
                        showFullscreenButtonTemporarily();
                    }
                });

                // Detectar teclas de pausa/play en el documento
                document.addEventListener('keydown', function(e) {
                    if (isFullscreen && (e.code === 'Space' || e.code === 'KeyP')) {
                        showFullscreenButtonTemporarily();
                    }
                });

                // Actualizar la función updateFullscreenIcon para manejar el estado
                const originalUpdateFullscreenIcon = updateFullscreenIcon;
                function updateFullscreenIcon() {
                    const icon = fullscreenBtn.querySelector('i');
                    if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                        icon.className = 'fas fa-compress';
                        fullscreenBtn.title = 'Salir de pantalla completa';
                        // Agregar clase al body para ocultar elementos
                        document.body.classList.add('fullscreen-active');
                        isFullscreen = true;
                        // Ocultar el botón después de un breve delay
                        setTimeout(() => {
                            if (isFullscreen) {
                                fullscreenBtn.classList.remove('show-temporarily');
                            }
                        }, 1000);
                    } else {
                        icon.className = 'fas fa-expand';
                        fullscreenBtn.title = 'Pantalla completa';
                        // Remover clase del body
                        document.body.classList.remove('fullscreen-active');
                        isFullscreen = false;
                        // Mostrar el botón normalmente
                        fullscreenBtn.classList.remove('show-temporarily');
                        clearTimeout(fullscreenButtonTimeout);
                    }
                }

                // Verificar cada 2 segundos si hay contenido
                setInterval(checkIfVideoIsPlaying, 2000);
                
                // Verificación inicial
                checkIfVideoIsPlaying();
            }
        });
    </script>
</body>

</html>
